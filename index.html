<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <title>Site Eval Dashboard (PoC)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;}
    .wrap{display:grid;grid-template-columns:1fr 1fr;gap:24px;}
    .card{padding:16px;border:1px solid #ddd;border-radius:12px;}
    h2{margin:.2em 0}
    .code{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <h1>Site Eval Dashboard (PoC)</h1>
  <div id="meta" class="card"></div>
  <div class="wrap">
    <div class="card"><h2>Tier1（三角値）</h2><div id="t1"></div></div>
    <div class="card"><h2>Tier2（レーダー）</h2><canvas id="radar" height="280"></canvas></div>
  </div>

  <script>
  (async function(){
    const API = 'YOUR_DEPLOY_URL/exec?latest=1'; // 例：&engine=codex&token=XXXX
    const res = await fetch(API); const data = await res.json();

    // Meta
    const meta = document.getElementById('meta');
    meta.innerHTML = `
      <h2>対象</h2>
      <div>URL: <a href="${data.run.target_url}" target="_blank" rel="noreferrer">${data.run.target_url}</a></div>
      <div>Run: <span class="code">${data.run.run_id}</span> / Engine: ${data.run.engine_label}</div>
      <div>SiteType: <span class="code">${data.site_type?.code||'-'}</span>
        （W/C=${data.site_type?.W_C?.pole||'-'} / B/S=${data.site_type?.B_S?.pole||'-'} /
         F/L=${data.site_type?.F_L?.pole||'-'} / H/T=${data.site_type?.H_T?.pole||'-'}）</div>
      <div>Evaluated: ${data.meta.evaluated_at||'-'}</div>
    `;

    // Tier1表示（数値）
    const t1 = (data.tier1||[]).reduce((m,x)=>{ m[x.name]=x.normalized_100; return m; },{});
    document.getElementById('t1').innerHTML =
      Object.entries(t1).map(([k,v])=>`${k}: <b>${v??'-'}</b>`).join(' / ');

    // レーダー（Tier2 normalized_100）
    const t2 = (data.tier2||[]).filter(x=> typeof x.normalized_100==='number');
    const ctx = document.getElementById('radar').getContext('2d');
    new Chart(ctx, {
      type:'radar',
      data:{
        labels: t2.map(d=>d.name),
        datasets:[{ label:'Tier2', data: t2.map(d=>d.normalized_100) }]
      },
      options:{
        responsive:true,
        scales:{ r:{ suggestedMin:0, suggestedMax:100, ticks:{ stepSize:20 } } },
        plugins:{ legend:{ display:false } }
      }
    });
  })();
  </script>
</body>
</html>
